<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SALES</title>
    <link rel="stylesheet" href="stylesheet/admin/salesReport.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <!-- DataTable HEADER-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">
    <!-- Include pdfmake library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/vfs_fonts.js"></script>
</head>

<body>
    <style>
    
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #f5f5f5;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    overflow-x: hidden;
}

.main-content {
    display: flex;
    flex: 1;
}

.content {
    flex: 1;
    padding: 20px;
    overflow-y: auto; /* Added overflow-y to allow scrolling if content overflows */
    margin-left: 200px;
}

/* Top Navigation */
.top-nav {
    margin-left: 200px;
    height: 80px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    background-color: rgb(246, 246, 246);
    padding: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

h1 {
    text-align: center;
    color: #333;
    margin-bottom: 30px;
    text-transform: uppercase;
}

.btn-container {
    text-align: right;
}

.btn {
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.btn-pdf,
.btn-excel {
    margin: 40px;
    padding: 8px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.btn-pdf:hover,
.btn-excel:hover {
    background-color: #f2f2f2;
}

/* Table Styles */
table {
    width: 110%; /* Adjusted width */
    border-collapse: collapse;
    margin-top: 20px;
}

th,
td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: left;
}

th {
    background-color: black;
    color: white;
    width: 230px;
}

tr:nth-child(even) {
    background-color: #f2f2f2;
}

.containerfirst {
    max-width: 89%; 
    margin: 0 auto; 
}

.space {
    margin-left: 200px;
    padding: 20px;
    padding-top: 30px; /* Adjusted padding for content area */
    display: flex;
    justify-content: space-around;
    align-items: flex-start;
    flex-wrap: wrap;
}

.overview-item {
    width: calc(45% - 20px); /* slightly reduced width */
    border-radius: 10px; /* slightly reduced border radius */
    padding: 25px;
    margin-bottom: 20px; /* slightly reduced margin bottom */
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
    text-align: center;
    transition: transform 0.3s ease-in-out;
}

.overview-item:nth-child(odd) {
    background-color: #131212; /* dark gray for odd items */
}

.overview-item:nth-child(even) {
    background-color: #2c3e50; /* blue-gray for even items */
}

.overview-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
}

.overview-item h3 {
    margin-top: 0;
    color: #fff;
    font-size: 1.6em; /* slightly reduced font size */
    text-transform: uppercase;
    margin-bottom: 10px; /* slightly reduced margin bottom */
}

.overview-item p {
    margin: 0;
    font-size: 1.2em; /* slightly reduced font size */
    font-weight: bold;
    color: #fff;
}

.btn-pdf, .btn-excel {
    font-size: 14px; 
    padding: 5px 10px; 
    line-height: 1; 
    border: 2px solid transparent; 
    border-radius: 10px; 
    cursor: pointer;
    transition: all 0.2s ease-in-out;
}

.btn-pdf {
    background-color: #007bff;
    color: white; 
    border-color: #007bff; 
}

.btn-pdf:hover {
    background-color: #0056b3; 
    border-color: #0056b3; 
}

.btn-excel {
    background-color: #28a745; 
    color: white; 
    border-color: #28a745; 
}

.btn-excel:hover {
    background-color: #218838; 
    border-color: #218838; 
}

/* Container for the form elements */
.form-container {
    display: flex;
    justify-content: center; /* Center the elements horizontally */
    align-items: center; /* Align items vertically in the center */
    gap: 10px; /* Space between the elements */
    padding: 10px; /* Padding around the container */
}

/* Styling for the date input fields */
input[type="date"] {
    width: 150px; /* Adjust this value to your preference */
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 16px;
    background-color: #f8f8f8;
}

/* Styling for the filter button */
.btn-filter {
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    background-color: #0e0e0e;
    color: white;
    font-size: 12px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.btn-filter:hover {
    background-color: #1c1e20;
}

/* Styling for the labels */
label {
    font-size: 14px;
    color: #333;
    margin-right: 5px; /* Add some space between the label and the input */
}

/* Table Styles */
.table {
    width: 100%; 
    border-collapse: collapse; 
    margin-top: 20px;
}

.table th,
.table td {
    border: 1px solid #ddd; 
    padding: 8px; 
    text-align: left; 
}

.table th {
    background-color: black; 
    color: white; 
    width: auto; 
}

.table tr:nth-child(even) {
    background-color: #f2f2f2; 
}

.welcome-heading {
    text-align: center; 
    color: #333;
    font-size: 2em; 
    margin-bottom: 20px; 
    text-transform: uppercase; 
    font-weight: bold; 
    letter-spacing: 1px;
}

.move-right {
    padding-left: 130px;
}

@media screen and (max-width: 768px) {
    .main-content {
        margin-left: 200px; /* Adjust main content margin */
    }

    .content {
        padding-left: 20px; /* Add padding to content to compensate for hidden sidebar */
    }
}

@media screen and (max-width: 576px) {
    .main-content {
        margin-left: 0; /* Adjust main content margin */
    }
}
  
  </style>
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
    <div class="toggle-sidebar">
        <i class="bx bx-menu toggle-icon"></i>
    </div>
     <%- include('sidebar') %>
    <div class="containerfirst">
        <h1 class="welcome-heading move-right">Welcome to Report Page</h1>
        <div class="space" style="margin-left: 250px;">
            <div class="overview-item overall-sales">
                <h3>Overall Sales Amount</h3>
                <p>₹<%= data.totalAmount %></p>
            </div>
            <div class="overview-item overall-order-amount">
                <h3>Total Orders</h3>
                <p><%= data.totalOrders %></p>
            </div>
            <div class="overview-item overall-discount">
                <h3>Total Users</h3>
                <p><%= data.user %></p>
            </div>
            <div class="overview-item total-product-numbers">
                <h3>Total Products</h3>
                <p><%= data.product %></p>
            </div>
        </div>
        <div class="content">
            <div class="btn-container">
                <span id="filterInfo"></span>
                <button onclick="printPDF()" id="pdfButton" class="btn-pdf">Download PDF</button>
                <button onclick="downloadExcel()" class="btn-excel">Download Excel</button>
                <form id="dateFilterForm" action="/admin/sales" method="GET">
                    <div class="form-container">
                        <label for="startDate">Start Date:</label>
                        <input type="date" id="startDate" name="startDate">
                        <label for="endDate">End Date:</label>
                        <input type="date" id="endDate" name="endDate">
                        <button type="submit" class="btn-filter"><i class="fas fa-filter"></i> Filter</button>
                    </div>
                </form>
            </div>
            <table id="example" class="table table-striped table-sm" style="width:100%">
                <thead>
                    <tr>
                        <th>Sl No</th>
                        <th>Product Name</th>
                        <th>User Details</th>
                        <th>Date</th>
                        <th>Quantity</th>
                        <th>Offer Price</th>
                        <th>Original Price</th>
                        <th>Payment Method</th>
                    </tr>
                </thead>
                <tbody>
                    <% salesReport.forEach(function(report, index) { %>
                    <tr>
                        <td><%= report.slNo %></td>
                        <td><%= report.proname %></td>
                        <td><%= report.address ? report.address : "Address Not Available" %></td>
                        <td><%= report.createdAt %></td>
                        <td><%= report.quantity %></td>
                        <td>₹<%= report.offerPrice %></td>
                        <td>₹<%= report.originalPrice %></td> <!-- Use originalPrice -->
                        <td>
                            <% if (report.paymentMethod === "razorpay") { %>
                                <strong>Online Payment</strong>
                            <% } else if(report.paymentMethod === "Cash On Delivery") { %>
                                <strong>COD</strong>
                            <% } else { %>
                                <strong>Wallet</strong>
                            <% } %>
                        </td>
                    </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/vfs_fonts.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.datatables.net/v/bs5/dt-1.13.8/datatables.min.js"></script>
    <script>
        new DataTable('#example');
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js" integrity="sha512-UnrKxsCMN9hFk7M56t4I4ckB4N/2HHi0w/7+B/1JsXIX3DmyBcsGpT3/BsuZMZf+6mAr0vP81syWtfynHJ69JA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        function printPDF() {
            const pdfTable = document.getElementById("example");
            const filterInfo = document.getElementById("filterInfo").innerText;
            const caption = pdfTable.querySelector("caption");
            if (caption) {
                caption.innerHTML += `<br>${filterInfo}`;
            } else {
                const caption = document.createElement("caption");
                caption.innerHTML = filterInfo;
                pdfTable.prepend(caption);
            }
            const pdfOptions = {
                margin: 1,
                filename: 'sales_report.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
            };
            html2pdf().set(pdfOptions).from(pdfTable).save();
        }

        function downloadExcel() {
            const form = document.getElementById("dateFilterForm");
            const startDate = form.querySelector("#startDate").value;
            const endDate = form.querySelector("#endDate").value;
            fetch('/admin/excel', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ startDate, endDate }),
            })
            .then(response => response.blob())
            .then(blob => {
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'sales_report.xlsx';
                document.body.appendChild(a);
                a.click();
                a.remove();
                window.URL.revokeObjectURL(url);
            })
            .catch(error => console.error('Error downloading Excel:', error));
        }
    </script>
</body>
</html>